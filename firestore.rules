rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. USUARIOS: Solo el dueño puede leer/escribir su perfil
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 2. ROBOT DE SINCRONIZACIÓN (Dual Backend 2.0)
    match /events/{eventId} {
      allow read: if true;
      allow write: if false;
    }
    match /odds/{oddId} {
      allow read: if true;
      allow write: if false;
    }
    match /sync_logs/{logId} {
      allow read: if true;
      allow write: if false;
    }

    // Colección antigua (Legacy/Compatibilidad)
    match /games/{gameId} {
      allow read: if true; 
      allow write: if false; 
    }

    // 4. HISTORIAL DE PREDICCIONES (Privado por usuario)
    match /predictions/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 5. COLECCIONES DE ESTADÍSTICAS NBA (Lectura pública, escritura denegada)
    match /nba_regular_season_box_scores_2024_25/{doc} { allow read: if true; allow write: if false; }
    match /nba_player_props/{doc} { allow read: if true; allow write: if false; }
    match /universal_player_props/{doc} { allow read: if true; allow write: if false; }

    // 6. SEGURIDAD ADICIONAL: Bloqueo total de logs y sistema
    match /admin_api_logs/{log} { allow read, write: if false; }
    match /_health_check/{check} { allow read, write: if false; }

    // Denegar cualquier otra cosa por defecto
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
