{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/web/app/api/proxy/player-image/[playerId]/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nexport const runtime = 'edge';\r\n\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: Promise<{ playerId: string }> }\r\n) {\r\n    const { playerId } = await params;\r\n\r\n    if (!playerId) {\r\n        return new NextResponse('Player ID required', { status: 400 });\r\n    }\r\n\r\n    const bridgeUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001';\r\n    const isVercel = !!process.env.VERCEL;\r\n\r\n    // --- PRIORITY 1: BRIDGE (TUNNEL) ---\r\n    if (bridgeUrl && bridgeUrl.startsWith('http')) {\r\n        const cleanBridgeUrl = bridgeUrl.trim().replace(/\\/$/, \"\");\r\n        const bridgeFetchUrl = `${cleanBridgeUrl}/api/proxy/player-image/${playerId}`;\r\n\r\n        try {\r\n            console.log(`üîå [Player Bridge] Routing to: ${bridgeFetchUrl}`);\r\n            const bridgeResponse = await fetch(bridgeFetchUrl, {\r\n                headers: {\r\n                    'User-Agent': 'PickGenius-Proxy-Bot',\r\n                    'ngrok-skip-browser-warning': 'true'\r\n                },\r\n                signal: AbortSignal.timeout(8000)\r\n            });\r\n\r\n            if (bridgeResponse.ok) {\r\n                const buffer = await bridgeResponse.arrayBuffer();\r\n                return new NextResponse(buffer, {\r\n                    headers: {\r\n                        'Content-Type': bridgeResponse.headers.get('Content-Type') || 'image/webp',\r\n                        'Cache-Control': 'public, max-age=86400, immutable'\r\n                    }\r\n                });\r\n            }\r\n        } catch (err: any) {\r\n            console.error(`‚ùå [Player Bridge] Logic failed: ${err.message}`);\r\n        }\r\n    }\r\n\r\n    // --- PRIORITY 2: DIRECT STEALTH (Weserv) ---\r\n    try {\r\n        const primaryUrl = `https://api.sofascore.app/api/v1/player/${playerId}/image`;\r\n        const proxyUrl = `https://wsrv.nl/?url=${encodeURIComponent(primaryUrl)}&w=200&h=200&fit=cover&a=top&output=webp&q=80`;\r\n\r\n        const response = await fetch(proxyUrl, {\r\n            headers: {\r\n                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'\r\n            }\r\n        });\r\n\r\n        if (response.ok) {\r\n            const buffer = await response.arrayBuffer();\r\n            return new NextResponse(buffer, {\r\n                headers: {\r\n                    'Content-Type': 'image/webp',\r\n                    'Cache-Control': 'public, max-age=86400, immutable'\r\n                }\r\n            });\r\n        }\r\n\r\n        return new NextResponse('Image not found', { status: 404 });\r\n    } catch (error) {\r\n        console.error('Error proxying player image:', error);\r\n        return new NextResponse('Error fetching image', { status: 404 });\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AACO,MAAM,UAAU;AAEhB,eAAe,IAClB,OAAoB,EACpB,EAAE,MAAM,EAA6C;IAErD,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM;IAE3B,IAAI,CAAC,UAAU;QACX,OAAO,IAAI,yMAAY,CAAC,sBAAsB;YAAE,QAAQ;QAAI;IAChE;IAEA,MAAM,YAAY,6DAAmC;IACrD,MAAM,WAAW,CAAC,CAAC,QAAQ,GAAG,CAAC,MAAM;IAErC,sCAAsC;IACtC,IAAI,aAAa,UAAU,UAAU,CAAC,SAAS;QAC3C,MAAM,iBAAiB,UAAU,IAAI,GAAG,OAAO,CAAC,OAAO;QACvD,MAAM,iBAAiB,GAAG,eAAe,wBAAwB,EAAE,UAAU;QAE7E,IAAI;YACA,QAAQ,GAAG,CAAC,CAAC,+BAA+B,EAAE,gBAAgB;YAC9D,MAAM,iBAAiB,MAAM,MAAM,gBAAgB;gBAC/C,SAAS;oBACL,cAAc;oBACd,8BAA8B;gBAClC;gBACA,QAAQ,YAAY,OAAO,CAAC;YAChC;YAEA,IAAI,eAAe,EAAE,EAAE;gBACnB,MAAM,SAAS,MAAM,eAAe,WAAW;gBAC/C,OAAO,IAAI,yMAAY,CAAC,QAAQ;oBAC5B,SAAS;wBACL,gBAAgB,eAAe,OAAO,CAAC,GAAG,CAAC,mBAAmB;wBAC9D,iBAAiB;oBACrB;gBACJ;YACJ;QACJ,EAAE,OAAO,KAAU;YACf,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,IAAI,OAAO,EAAE;QAClE;IACJ;IAEA,8CAA8C;IAC9C,IAAI;QACA,MAAM,aAAa,CAAC,wCAAwC,EAAE,SAAS,MAAM,CAAC;QAC9E,MAAM,WAAW,CAAC,qBAAqB,EAAE,mBAAmB,YAAY,6CAA6C,CAAC;QAEtH,MAAM,WAAW,MAAM,MAAM,UAAU;YACnC,SAAS;gBACL,cAAc;YAClB;QACJ;QAEA,IAAI,SAAS,EAAE,EAAE;YACb,MAAM,SAAS,MAAM,SAAS,WAAW;YACzC,OAAO,IAAI,yMAAY,CAAC,QAAQ;gBAC5B,SAAS;oBACL,gBAAgB;oBAChB,iBAAiB;gBACrB;YACJ;QACJ;QAEA,OAAO,IAAI,yMAAY,CAAC,mBAAmB;YAAE,QAAQ;QAAI;IAC7D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,IAAI,yMAAY,CAAC,wBAAwB;YAAE,QAAQ;QAAI;IAClE;AACJ"}}]
}