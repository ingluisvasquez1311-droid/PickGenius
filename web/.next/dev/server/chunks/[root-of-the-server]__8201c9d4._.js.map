{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Daniel/PickGenius/web/lib/firebaseAdmin.ts"],"sourcesContent":["import * as admin from 'firebase-admin';\r\nimport { readFileSync, existsSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\n// Singleton para evitar m√∫ltiples inicializaciones\r\nlet firebaseApp: admin.app.App | null = null;\r\n\r\nexport function initializeFirebaseAdmin(): admin.app.App {\r\n    // Si ya hay apps inicializadas, intentar recuperar la [DEFAULT]\r\n    if (admin.apps.length > 0) {\r\n        console.log('‚úÖ Re-usando instancia de Firebase Admin existente');\r\n        firebaseApp = admin.apps[0]!;\r\n        return firebaseApp;\r\n    }\r\n\r\n    try {\r\n        console.log('üîß Intentando inicializar Firebase Admin...');\r\n\r\n        // M√âTODO 1: Intentar cargar desde archivo JSON (M√ÅS CONFIABLE)\r\n        const possiblePaths = [\r\n            // When started from PickGenius root\r\n            join(process.cwd(), 'firebase-service-account.json'),\r\n            join(process.cwd(), 'firebase-seervice-account.json'), // Soporte para el typo detectado\r\n            join(process.cwd(), 'firebase-credentials.json'),\r\n            // When started from web directory\r\n            join(process.cwd(), '..', 'firebase-service-account.json'),\r\n            join(process.cwd(), '..', 'firebase-seervice-account.json'),\r\n            join(process.cwd(), '..', 'firebase-credentials.json'),\r\n            // Absolute Windows paths\r\n            'C:\\\\Users\\\\Daniel\\\\PickGenius\\\\firebase-service-account.json',\r\n            'C:\\\\Users\\\\Daniel\\\\PickGenius\\\\firebase-seervice-account.json'\r\n        ];\r\n\r\n        for (const serviceAccountPath of possiblePaths) {\r\n            if (existsSync(serviceAccountPath)) {\r\n                try {\r\n                    const serviceAccount = JSON.parse(readFileSync(serviceAccountPath, 'utf8'));\r\n\r\n                    firebaseApp = admin.initializeApp({\r\n                        credential: admin.credential.cert(serviceAccount),\r\n                        projectId: serviceAccount.project_id,\r\n                        databaseURL: process.env.FIREBASE_DATABASE_URL || `https://${serviceAccount.project_id}.firebaseio.com`\r\n                    });\r\n\r\n                    console.log(`‚úÖ Firebase Admin inicializado desde archivo: ${serviceAccountPath}`);\r\n                    console.log('  Project ID:', firebaseApp.options.projectId);\r\n                    return firebaseApp;\r\n                } catch (e: any) {\r\n                    console.warn(`‚ö†Ô∏è Error leyendo ${serviceAccountPath}:`, e.message);\r\n                }\r\n            }\r\n        }\r\n\r\n        // M√âTODO 2: Usar FIREBASE_SERVICE_ACCOUNT (JSON completo en variable)\r\n        if (process.env.FIREBASE_SERVICE_ACCOUNT) {\r\n            try {\r\n                const serviceAccount = JSON.parse(process.env.FIREBASE_SERVICE_ACCOUNT);\r\n\r\n                firebaseApp = admin.initializeApp({\r\n                    credential: admin.credential.cert(serviceAccount),\r\n                    projectId: serviceAccount.project_id,\r\n                    databaseURL: process.env.FIREBASE_DATABASE_URL || `https://${serviceAccount.project_id}.firebaseio.com`\r\n                });\r\n\r\n                console.log('‚úÖ Firebase Admin inicializado desde FIREBASE_SERVICE_ACCOUNT');\r\n                console.log('  Project ID:', firebaseApp.options.projectId);\r\n                return firebaseApp;\r\n            } catch (jsonError) {\r\n                console.warn('‚ö†Ô∏è Error parseando FIREBASE_SERVICE_ACCOUNT');\r\n            }\r\n        }\r\n\r\n        // M√âTODO 3: Usar variables individuales (√öLTIMO RECURSO)\r\n        const projectId = process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID || process.env.FIREBASE_PROJECT_ID;\r\n        const clientEmail = process.env.FIREBASE_CLIENT_EMAIL;\r\n        const privateKeyBase64 = process.env.FIREBASE_SERVICE_ACCOUNT_BASE64;\r\n\r\n        if (!projectId || !clientEmail) {\r\n            throw new Error('Faltan credenciales de Firebase (projectId o clientEmail)');\r\n        }\r\n\r\n        // Intentar con Base64\r\n        if (privateKeyBase64) {\r\n            try {\r\n                const privateKey = Buffer.from(privateKeyBase64, 'base64').toString('utf8');\r\n\r\n                firebaseApp = admin.initializeApp({\r\n                    credential: admin.credential.cert({\r\n                        projectId: projectId,\r\n                        clientEmail: clientEmail,\r\n                        privateKey: privateKey\r\n                    }),\r\n                    projectId: projectId,\r\n                    databaseURL: process.env.FIREBASE_DATABASE_URL || `https://${projectId}.firebaseio.com`\r\n                });\r\n\r\n                console.log('‚úÖ Firebase Admin inicializado desde Base64');\r\n                console.log('  Project ID:', firebaseApp.options.projectId);\r\n                return firebaseApp;\r\n            } catch (base64Error) {\r\n                console.warn('‚ö†Ô∏è Error usando Base64');\r\n            }\r\n        }\r\n\r\n        throw new Error('No se pudo inicializar Firebase con ning√∫n m√©todo disponible');\r\n\r\n    } catch (error: any) {\r\n        console.error('‚ùå Error cr√≠tico al inicializar Firebase Admin:');\r\n        console.error('Error Details:', error);\r\n\r\n        // No throw here, return null to let the system handle \"No connection\" gracefully if possible\r\n        // but since many services depend on it, we might still want to throw if it's a CRON task.\r\n        const errorMsg = error instanceof Error ? error.message : String(error);\r\n        throw new Error(`Failed to initialize Firebase Admin: ${errorMsg}`);\r\n    }\r\n}\r\n\r\nlet firestoreDb: admin.firestore.Firestore | null = null;\r\n\r\n// Obtener instancia de Firestore\r\nexport function getFirestore(): admin.firestore.Firestore {\r\n    if (firestoreDb) return firestoreDb;\r\n\r\n    const app = initializeFirebaseAdmin();\r\n    firestoreDb = app.firestore();\r\n\r\n    // Enforce ignoring undefined properties globally (ONLY ONCE)\r\n    try {\r\n        firestoreDb.settings({ ignoreUndefinedProperties: true });\r\n    } catch (e) {\r\n        console.warn('‚ö†Ô∏è Firestore settings already applied or could not be set');\r\n    }\r\n\r\n    return firestoreDb;\r\n}\r\n\r\n// Verificar conexi√≥n a Firebase\r\nexport async function verifyFirebaseConnection(): Promise<boolean> {\r\n    try {\r\n        const db = getFirestore();\r\n\r\n        await db.collection('_health_check').doc('test').set({\r\n            timestamp: admin.firestore.FieldValue.serverTimestamp(),\r\n            status: 'ok'\r\n        });\r\n\r\n        console.log('‚úÖ Conexi√≥n a Firebase Firestore verificada correctamente');\r\n        return true;\r\n    } catch (error) {\r\n        console.error('‚ùå Error verificando conexi√≥n a Firebase:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n// Health check\r\nexport async function getFirebaseHealth(): Promise<{\r\n    connected: boolean;\r\n    projectId: string | null;\r\n    error?: string;\r\n}> {\r\n    try {\r\n        if (!firebaseApp) {\r\n            firebaseApp = initializeFirebaseAdmin();\r\n        }\r\n\r\n        const db = getFirestore();\r\n\r\n        await db.collection('_health_check').doc('status').set({\r\n            timestamp: admin.firestore.FieldValue.serverTimestamp(),\r\n            status: 'healthy'\r\n        });\r\n\r\n        return {\r\n            connected: true,\r\n            projectId: firebaseApp.options.projectId || null\r\n        };\r\n    } catch (error) {\r\n        return {\r\n            connected: false,\r\n            projectId: process.env.FIREBASE_PROJECT_ID || process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID || null,\r\n            error: error instanceof Error ? error.message : 'Unknown error'\r\n        };\r\n    }\r\n}\r\n\r\nexport default {\r\n    initializeFirebaseAdmin,\r\n    getFirestore,\r\n    verifyFirebaseConnection,\r\n    getFirebaseHealth\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Daniel/PickGenius/web/lib/FirebaseReadService.ts"],"sourcesContent":["import { getFirestore } from './firebaseAdmin';\r\nimport { Timestamp } from 'firebase-admin/firestore';\r\n\r\nexport interface Game {\r\n    id: string;\r\n    sport: string;\r\n    status: string; // 'Scheduled', 'Live', 'Finished', etc.\r\n    homeTeam: string;\r\n    awayTeam: string;\r\n    startTime: Date;\r\n    // ... otros campos\r\n    [key: string]: any;\r\n}\r\n\r\nclass FirebaseReadService {\r\n    private db;\r\n\r\n    constructor() {\r\n        this.db = getFirestore();\r\n    }\r\n\r\n    /**\r\n     * Verifica si hay datos recientes para un deporte y estado espec√≠fico.\r\n     * √ötil para decidir si disparar una sincronizaci√≥n de fondo.\r\n     */\r\n    async hasRecentData(sport: string, statusCategory: 'live' | 'scheduled' | 'finished'): Promise<boolean> {\r\n        try {\r\n            const eventsRef = this.db.collection('events');\r\n            let query = eventsRef.where('sport', '==', sport);\r\n\r\n            if (statusCategory === 'live') {\r\n                query = query.where('status', '==', 'inprogress');\r\n            } else if (statusCategory === 'scheduled') {\r\n                query = query.where('status', 'in', ['notstarted', 'scheduled']);\r\n            } else if (statusCategory === 'finished') {\r\n                query = query.where('status', '==', 'finished');\r\n            }\r\n\r\n            const snapshot = await query.limit(1).get();\r\n            return !snapshot.empty;\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error checking recent data for ${sport}:`, error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtiene juegos en vivo desde la colecci√≥n 'events'\r\n     */\r\n    async getLiveGames(sport: string): Promise<any[]> {\r\n        try {\r\n            const snapshot = await this.db.collection('events')\r\n                .where('sport', '==', sport)\r\n                .where('status', '==', 'inprogress')\r\n                .get();\r\n\r\n            return this.mapSnapshotToEvents(snapshot);\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error fetching live ${sport}:`, error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtiene juegos programados desde la colecci√≥n 'events'\r\n     */\r\n    async getScheduledGames(sport: string): Promise<any[]> {\r\n        try {\r\n            const now = new Date();\r\n            const snapshot = await this.db.collection('events')\r\n                .where('sport', '==', sport)\r\n                .where('status', 'in', ['notstarted', 'scheduled'])\r\n                .where('startTime', '>=', now)\r\n                .orderBy('startTime', 'asc')\r\n                .limit(50)\r\n                .get();\r\n\r\n            return this.mapSnapshotToEvents(snapshot);\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error fetching scheduled ${sport}:`, error);\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Obtiene un evento espec√≠fico por ID desde la colecci√≥n 'events'\r\n     */\r\n    async getEventById(eventId: string | number): Promise<any | null> {\r\n        try {\r\n            // Buscamos por el ID del documento (que es el externalId de Sofascore)\r\n            const doc = await this.db.collection('events').doc(eventId.toString()).get();\r\n            if (!doc.exists) return null;\r\n\r\n            const data = doc.data();\r\n            // Mapeamos a la estructura de LiveEvent para consistencia\r\n            const events = this.mapSnapshotToEvents({ docs: [doc] } as any);\r\n            return events[0] || null;\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error fetching event ${eventId} from Firebase:`, error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    async getMatchStats(gameId: string | number): Promise<any | null> {\r\n        try {\r\n            // Intentar buscar en matchStats (estructura antigua) o eventos enriquecidos\r\n            const doc = await this.db.collection('matchStats').doc(gameId.toString()).get();\r\n            return doc.exists ? doc.data() : null;\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error fetching match stats for ${gameId}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    async getMarketLine(gameId: string | number, sport: string): Promise<any | null> {\r\n        try {\r\n            // Ahora leemos de la colecci√≥n 'odds' creada por el Robot 2\r\n            const doc = await this.db.collection('odds').doc(`${sport}_${gameId}`).get();\r\n            return doc.exists ? doc.data() : null;\r\n        } catch (error) {\r\n            console.error(`[FirebaseRead] Error fetching market line for ${gameId}:`, error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    private mapSnapshotToEvents(snapshot: FirebaseFirestore.QuerySnapshot): any[] {\r\n        return snapshot.docs.map(doc => {\r\n            const data = doc.data();\r\n\r\n            // Mapeo de compatibilidad con LiveEvent interface del frontend\r\n            return {\r\n                ...data,\r\n                id: data.externalId || doc.id,\r\n                status: {\r\n                    type: data.status, // 'inprogress', 'notstarted', 'finished'\r\n                    description: data.statusDescription || (data.status === 'inprogress' ? 'En Vivo' : data.status === 'finished' ? 'Finalizado' : 'Programado')\r\n                },\r\n                homeScore: {\r\n                    current: data.homeTeam?.score || 0,\r\n                    period1: data.homeTeam?.halfScore || 0\r\n                },\r\n                awayScore: {\r\n                    current: data.awayTeam?.score || 0,\r\n                    period1: data.awayTeam?.halfScore || 0\r\n                },\r\n                // Asegurar que Teams tengan el formato { id, name, logo }\r\n                homeTeam: {\r\n                    id: data.homeTeam?.id,\r\n                    name: data.homeTeam?.name,\r\n                    logo: data.homeTeam?.logo\r\n                },\r\n                awayTeam: {\r\n                    id: data.awayTeam?.id,\r\n                    name: data.awayTeam?.name,\r\n                    logo: data.awayTeam?.logo\r\n                },\r\n                startTime: data.startTime instanceof Timestamp ? data.startTime.toDate() : (data.startTime ? new Date(data.startTime) : new Date()),\r\n                syncedAt: data.syncedAt instanceof Timestamp ? data.syncedAt.toDate() : (data.syncedAt ? new Date(data.syncedAt) : new Date()),\r\n                startTimestamp: data.startTime instanceof Timestamp ? Math.floor(data.startTime.toDate().getTime() / 1000) : (data.startTime ? Math.floor(new Date(data.startTime).getTime() / 1000) : 0)\r\n            };\r\n        });\r\n    }\r\n}\r\n\r\nexport const firebaseReadService = new FirebaseReadService();\r\nexport default firebaseReadService;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 383, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Daniel/PickGenius/web/app/api/basketball/scheduled/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { firebaseReadService } from '@/lib/FirebaseReadService';\r\nimport { initializeFirebaseAdmin } from '@/lib/firebaseAdmin';\r\n\r\ntry {\r\n    initializeFirebaseAdmin();\r\n} catch (error) {\r\n    console.error('‚ùå Error inicializando Firebase:', error);\r\n}\r\n\r\nexport const dynamic = 'force-dynamic';\r\nexport const revalidate = 0;\r\n\r\nexport async function GET() {\r\n    const startTime = Date.now();\r\n    const SPORT_ID = 'basketball';\r\n    const TYPE = 'scheduled';\r\n\r\n    try {\r\n\r\n        const hasRecentData = await firebaseReadService.hasRecentData(SPORT_ID, TYPE);\r\n\r\n        if (!hasRecentData) {\r\n            console.warn(`‚ö†Ô∏è No recent data for ${SPORT_ID} ${TYPE}, triggering background sync`);\r\n            fetch(`http://localhost:3001/api/trigger/sofascore`, { method: 'POST' })\r\n                .catch(err => console.error('Sync trigger failed:', err));\r\n        }\r\n\r\n        const games = await firebaseReadService.getScheduledGames(SPORT_ID);\r\n        const duration = Date.now() - startTime;\r\n\r\n        return NextResponse.json({ events: games }, {\r\n            headers: {\r\n                'X-Response-Time': `${duration}ms`,\r\n                'X-Data-Source': 'firebase'\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(`‚ùå Error in ${SPORT_ID} ${TYPE} route:`, error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to fetch games' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;;;;;AAEA,IAAI;IACA,IAAA,wJAAuB;AAC3B,EAAE,OAAO,OAAO;IACZ,QAAQ,KAAK,CAAC,mCAAmC;AACrD;AAEO,MAAM,UAAU;AAChB,MAAM,aAAa;AAEnB,eAAe;IAClB,MAAM,YAAY,KAAK,GAAG;IAC1B,MAAM,WAAW;IACjB,MAAM,OAAO;IAEb,IAAI;QAEA,MAAM,gBAAgB,MAAM,0JAAmB,CAAC,aAAa,CAAC,UAAU;QAExE,IAAI,CAAC,eAAe;YAChB,QAAQ,IAAI,CAAC,CAAC,sBAAsB,EAAE,SAAS,CAAC,EAAE,KAAK,4BAA4B,CAAC;YACpF,MAAM,CAAC,2CAA2C,CAAC,EAAE;gBAAE,QAAQ;YAAO,GACjE,KAAK,CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,wBAAwB;QAC5D;QAEA,MAAM,QAAQ,MAAM,0JAAmB,CAAC,iBAAiB,CAAC;QAC1D,MAAM,WAAW,KAAK,GAAG,KAAK;QAE9B,OAAO,uJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAM,GAAG;YACxC,SAAS;gBACL,mBAAmB,GAAG,SAAS,EAAE,CAAC;gBAClC,iBAAiB;YACrB;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,CAAC,WAAW,EAAE,SAAS,CAAC,EAAE,KAAK,OAAO,CAAC,EAAE;QACvD,OAAO,uJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}