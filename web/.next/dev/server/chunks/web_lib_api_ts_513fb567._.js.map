{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Daniel/PickGenius/web/lib/api.ts"],"sourcesContent":["// Configuraci√≥n centralizada de la API\r\nconst isServer = typeof window === 'undefined';\r\nconst DEFAULT_BASE_URL = isServer ? (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : 'http://localhost:3000') : '';\r\nexport const API_URL = process.env.NEXT_PUBLIC_API_BASE_URL || DEFAULT_BASE_URL;\r\n\r\nexport async function fetchAPI(endpoint: string, options?: RequestInit, retries = 3, backoff = 1000) {\r\n    // Ensure endpoint starts with / if it's not an absolute URL\r\n    const isAbsolute = endpoint.startsWith('http');\r\n    let url = endpoint;\r\n\r\n    if (!isAbsolute) {\r\n        // En el servidor, necesitamos URLs absolutas. En el cliente, las relativas funcionan (pero las absolutas tambi√©n).\r\n        const baseUrl = API_URL.replace(/\\/$/, '');\r\n        const cleanEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\r\n        url = `${baseUrl}${cleanEndpoint}`;\r\n    }\r\n\r\n    console.log(`üîç [API] Fetching: ${url} (Retries left: ${retries})`);\r\n\r\n    try {\r\n        const response = await fetch(url, {\r\n            ...options,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'ngrok-skip-browser-warning': 'true',\r\n                'bypass-tunnel-reminder': 'true',\r\n                ...options?.headers,\r\n            },\r\n        });\r\n\r\n        // Handle Rate Limiting (429) or Service Unavailable (503)\r\n        if ((response.status === 429 || response.status === 503) && retries > 0) {\r\n            const waitTime = backoff * (4 - retries); // Exponential backoff: 1s, 2s, 3s\r\n            console.warn(`‚ö†Ô∏è [API] HTTP ${response.status} detected. Retrying in ${waitTime}ms...`);\r\n            await new Promise(resolve => setTimeout(resolve, waitTime));\r\n            return fetchAPI(endpoint, options, retries - 1, backoff);\r\n        }\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return data;\r\n    } catch (error) {\r\n        if (retries > 0) {\r\n            console.warn(`‚ö†Ô∏è [API] Fetch error, retrying (${retries} left):`, error);\r\n            await new Promise(resolve => setTimeout(resolve, backoff));\r\n            return fetchAPI(endpoint, options, retries - 1, backoff);\r\n        }\r\n        console.error('‚ùå [API] Final error fetching:', url, error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA,uCAAuC;AACvC,MAAM,WAAW,kDAAkB;AACnC,MAAM,mBAAmB,uCAAY,QAAQ,GAAG,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,UAAU,EAAE,GAAG,0BAA2B;AACxH,MAAM,UAAU,QAAQ,GAAG,CAAC,wBAAwB,IAAI;AAExD,eAAe,SAAS,QAAgB,EAAE,OAAqB,EAAE,UAAU,CAAC,EAAE,UAAU,IAAI;IAC/F,4DAA4D;IAC5D,MAAM,aAAa,SAAS,UAAU,CAAC;IACvC,IAAI,MAAM;IAEV,IAAI,CAAC,YAAY;QACb,mHAAmH;QACnH,MAAM,UAAU,QAAQ,OAAO,CAAC,OAAO;QACvC,MAAM,gBAAgB,SAAS,UAAU,CAAC,OAAO,WAAW,CAAC,CAAC,EAAE,UAAU;QAC1E,MAAM,GAAG,UAAU,eAAe;IACtC;IAEA,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,IAAI,gBAAgB,EAAE,QAAQ,CAAC,CAAC;IAElE,IAAI;QACA,MAAM,WAAW,MAAM,MAAM,KAAK;YAC9B,GAAG,OAAO;YACV,SAAS;gBACL,gBAAgB;gBAChB,8BAA8B;gBAC9B,0BAA0B;gBAC1B,GAAG,SAAS,OAAO;YACvB;QACJ;QAEA,0DAA0D;QAC1D,IAAI,CAAC,SAAS,MAAM,KAAK,OAAO,SAAS,MAAM,KAAK,GAAG,KAAK,UAAU,GAAG;YACrE,MAAM,WAAW,UAAU,CAAC,IAAI,OAAO,GAAG,kCAAkC;YAC5E,QAAQ,IAAI,CAAC,CAAC,cAAc,EAAE,SAAS,MAAM,CAAC,uBAAuB,EAAE,SAAS,KAAK,CAAC;YACtF,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;YACjD,OAAO,SAAS,UAAU,SAAS,UAAU,GAAG;QACpD;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,SAAS,MAAM,CAAC,EAAE,EAAE,SAAS,UAAU,EAAE;QACrE;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,IAAI,UAAU,GAAG;YACb,QAAQ,IAAI,CAAC,CAAC,gCAAgC,EAAE,QAAQ,OAAO,CAAC,EAAE;YAClE,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;YACjD,OAAO,SAAS,UAAU,SAAS,UAAU,GAAG;QACpD;QACA,QAAQ,KAAK,CAAC,iCAAiC,KAAK;QACpD,MAAM;IACV;AACJ"}}]
}